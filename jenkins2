pipeline {
    agent any
    
    stages {
        stage("checkout code") {
            steps {
                checkout scmGit(branches: [[name: '*/main']], extensions: [], userRemoteConfigs: [[url: 'https://github.com/murthymo/AppStore.git']])
                
                sh '''
                echo "=== Files after checkout ==="
                ls -la
                echo "=== Looking for pom.xml ==="
                find . -name pom.xml -type f
                '''
            }
        }
        stage("building application") {
            steps {
                sh '''
                echo "building application"
                
                # Check if this is a Maven project
                if [ -f "pom.xml" ]; then
                    echo "Found pom.xml - this is a Maven project"
                    /usr/local/bin/mvn --version
                    /usr/local/bin/mvn clean package
                else
                    echo "No pom.xml found - checking for other project types..."
                    
                    # Check for Node.js project
                    if [ -f "package.json" ]; then
                        echo "Found package.json - this is a Node.js project"
                        npm --version
                        npm install
                        npm run build
                    # Check for Python project
                    elif [ -f "requirements.txt" ] || [ -f "setup.py" ] || [ -f "pyproject.toml" ]; then
                        echo "Found Python project files"
                        python --version
                        pip install -r requirements.txt || echo "No requirements.txt found"
                        python setup.py build || echo "No setup.py found"
                    # Check for Gradle project
                    elif [ -f "build.gradle" ] || [ -f "build.gradle.kts" ]; then
                        echo "Found build.gradle - this is a Gradle project"
                        ./gradlew --version
                        ./gradlew build
                    else
                        echo "⚠️  No recognized project files found!"
                        echo "Repository contents:"
                        ls -la
                        echo ""
                        echo "This appears to be an empty repository or contains only configuration files."
                        echo "Please add your application code to the repository."
                        exit 1
                    fi
                fi
                
                echo "application built successfully"
                '''
            }
        }
    }
}
